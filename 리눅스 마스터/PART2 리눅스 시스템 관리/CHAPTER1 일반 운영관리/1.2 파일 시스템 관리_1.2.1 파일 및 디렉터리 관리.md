# PART2 리눅스 시스템 관리[CHAPTER1 일반 운영 관리]


<br>


### 1.2 파일 시스템 관리 

#### 1.2.1 파일 및 디렉터리 관리

- 소유권과 허가권
    - 다수의 사용자들이 동일한 저장공간인 하드 디스크를 공유하여 사용 하기 때문에 생기는 문제를 해결 하기 위함
    - 권한 설정 확인 : ls - l 파일명

       ![image](https://user-images.githubusercontent.com/93310395/237046871-550c5acd-be73-4357-a588-d5ef53797b09.png)

       - 1번 : 허가권 , 2번 : 소유권, 3번 : 그룹 소유권
       - 허가권 설명

            |권한|파일|디렉터리|
            |---|---|---|
            |r|파일 내용 읽을 수 있음|디렉터리 내부의 내용 읽을 수 있음|
            |w|파일 내용 수정할 수 있음|디렉터리 내부의 파일 생성 또는 삭제 할 수 있음|
            |x|실행 파일을 실행시킬 수 있음|디렉터리 내부로 접근할 수 있음|

- 특수권한
    - 특수 권한의 개요
        - 기본 권한 체계로 원활한 시스템 운영이 어렵고 일반 사용자가 root 사용자의 권한이 필요할 경우 일부 권한 허용등을 위한 특별한 권한 부여
        - 특수 권한

            |특수권한|설명|확인|설정|
            |---|---|---|---|
            |Set-UID|- 실행 파일 주 사용 <br> - 해당 파일을 실행하는 동안에는 실행시킨 사용자의 권한이 아닌 해당 파일의 소유자 권한으로 인식 <br> - 소유자 권한 x 자리 >> s, 실행 권한 파일일 경우 S로 표시|passwd 명령(일반 사용자는 /etc/shadow에 접근 불가능)|chmod(허가권 설정명령), 문자 모드 s, 숫자모드 4|
            |Set-GID|- 해당 파일을 소유한 그룹 권한으로 인식 <br> - 주로 디렉터리에 설정, 이 디렉터리에 파일이나 디렉터리 생성 >> 사용자가 속한 그룹에 상관없이 디렉터리 소유 권한으로 생성||chmod(허가권 설정명령), 문자 모드 s, 숫자모드 2|
            |Sticky-Bit|- 디렉터리에 설정되는 특수 권한 <br>- 다수의 사용자들이 생성의 제한은 없지만 삭제는 제한(각 사용자가 생성한 파일만 삭제 가능) <br> - Group과 other 사용자에게 설정 가능(중복 설정 불가능) <br> - other 계층권한 있음 x자리 >> t 표시, other 계층권한 없음 >> T로 표시|/tmp 디렉터리(임시 저장 디렉터리, X윈도 실행시에 필요한 소켓 등 일시적으로 시스템이나 응용 프로그램에 필요한 파일 저장) |chmod(허가권 설정명령), 문자 모드 t, 숫자모드 1|

- 관련 명령어
    - chmod(change mode)
        - 파일이나 디렉터리에 접근할 수 있는 허가권 설정
        - 문자모드 : 알파벳, 숫자모드 : 8진수
        - 문자모드

            |구분|문자|설명|
            |---|---|---|
            |권한|r,w,x|읽기, 쓰기, 실행|
            |사용자|u,g,o,a|- u : 파일 소유자 접근 권한 <br> - g : 그룹 사용자 접근 권한 <br> - o : 다른 사용자 접근 권한 <br> - 모든 사용자 접근 권한 |
            |설정|+,-,=|- 기존권한 설정 및 해제(+,-) <br> - 특정 권한 지정 : =|

        - 숫자 모드

            |구분|숫자|설명|
            |---|---|---|
            |권한|4,2,1,0 조합| - r(읽기) : 4 <br> - w(쓰기) : 2 <br> - x(실행) : 1 |
            |중복 권한| - 모든 권한 : 7 <br> - 읽기, 쓰기 권한 : 6 <br> - 읽기, 실행 : 5 , - 권한 업음 : 0|
            |사용자 계층|| - 기본 사용자 : 3, - 각각 소유자 : 100의 자리 <br> - 그룹 사용자 : 10의 자리 <br> - 다른 사용자 : 1의자리 |
        
        - 숫자모드 예시
            - Owner: rwx = 4+2+1 = 7
            - Group: r-x = 4+0+1 = 5
            - Other: r-x = 4+0+1 = 5


        - 사용법
            ```` 
                $ chmod [option] mode file(s)

        - 주요 옵션

                |옵션|설명|
                |---|---|
                |-R| 하위 디렉터리 포함 디렉터리 내부의 모든 파일의 접근 권한 변경|
                |-c|변경된 정보 출력|             
                |-f|주요한 오류 메세지가 아니면 출력하지 않음|
                |-v|명령 진행 결과 자세히 출력|
                |-version|명령어의 버전 정보 출력|

        - 사용 예시
            ````
                $ chmod ugo+rwx aa.txt : 모든 사용자에게 모든 권한 부여 = 'chmod a+rwx aa.txt , chmod 777 aa.txt'
                $ chmod a+r *.txt : .txt로 끝나는 파일들에 대하 모든 사용자가 읽을 수 있도록 설정
                # chmod a= a.txt : a.txt에 어떠한 권한도 설정하지 않음
                # chmod u+s a.out : a.out 파일에 Set-UID 설정
                # chmod g+s,o+t /project : /project라는 디렉터리에 set-GID 부여하여 파일 생성시 자동으로 그룹소유권 지정, 그룹 사용간의 공류 모드로 사용


                * chmod 명령으로 사용자층을 지정하지 않으면 a라고 인식하지만, +rwx로 지정하면 other계층의 w 권한은 부여하지 않음 

    - chown(change own)
        - 파일이나 디렉터리의 소유권 및 그룹 소유권 변경
        - 사용법
            ````
                # chmown [option] owner[:group] file(s)
        
        - 주요 옵션(chmod와 같음)

                |옵션|설명|
                |---|---|
                |-R| 하위 디렉터리 포함 디렉터리 내부의 모든 파일의 접근 권한 변경|
                |-c|변경된 정보 출력|             
                |-f|주요한 오류 메세지가 아니면 출력하지 않음|
                |-v|명령 진행 결과 자세히 출력|
                |-version|명령어의 버전 정보 출력|       

        - 사용 예시
            ````
                # chmod -R posein * : 하위 디렉터리 포함 현재 디렉터리의 모든 파일 소유자를 posein으로 변경
                # chomod posein:tarran lin.txt : lin.txt의 소유자를 posein으로 tarran을 소유 그룹으로 지정

    - chgrp(chnage group)
        - root 사용자가 아니면 거의 사용 안 함 
        - 특정 사용자가 여러 그룹에 속한 본인 소유의 파일을 본인 그룹에 소유권으로 변경 가능
        - 사용법
            ````
                # chgrp [option] group file(s)
        
        - 주요 옵션(-h제외 chmod, chown과 같음)
            - h : 심볼릭 링크 파일의 그룹 소유권 변경(보통 그룹 소유권 변경시 원본 파일의 소유권이 변경됨)

    - umask
        - 파일이나 디렉터리 생성 시 부여되는 기본 허가권 값 지정
        - 기본 생성 권한은 666이며 디렉토리의 경우 777 (umask 설정 값이 022 일시 : file: 666 - 022 = 644, directory: 777 - 022 = 755)

        - 사용법
            ````
                $ umask [option] [값]

        - 주요 옵션
            - S : umask 값 문자로 표기        

- 파일링크
    - 파일 링크의 개요
        - 파일, 디렉터리 생성(I-node 부여) >> I-node로 관리(파일명이 다르더라도 I-node가 같으면 같은 파일로 인식), ls-i로 확인 가능 >> 링크 : 티렉터리 접근 경로를 단축하는 형태 
        - 하드 링크, 심볼릭 링크(Symbolic Link)/소프트 링크
    - 관련 명령어 : ln
        - 하드 링크 또는 심볼릭 링크를 생성하는 명령
        - 명령 실행 시 옵션 없이 사용 : 하드링크 생성, -s 옵션 사용 : 심볼릭 링크 생성
        - 사용법
            ````
                $ ln [option] 원본 대상파일명
        - 주요 옵션

            |옵션|설명|
            |---|---|
            |-s|심볼릭 링크 생성시 사용|
            |-v|링크를 만드는 정보 자세히 출력|
            |-f|링크 파일 존재시 삭제하고 생성|

        - 사용 예시
            ````
                $ ln joon.txt k : joon.txt 파일의 하드링크 파일인 k를 현재 디렉터리에 생성
                $ ln -s /etc/xinetd.d x : /etc/xinetd.d의 심볼릭 링크 파일인 x를 현재 디렉터리에 생성

    - 하드 링크와 심볼릭 링크
        - 하드링크
            - 하나의 동일한 파일을 디스크의 다른 곳에 배치하여 여러 이름으로 사용되는 형식
            - 하드링크 특징
                - I- node 번호가 원본과 링크 파일의 번호가 같음
                - 원본과 링크 파일의 내용과 파일 크기가 같음
                - 원본이나 링크 파일 중에 어떠한 파일을 수정해도 같이 반영
                - 원본 파일을 삭제해도 링크 파일은 영향 받지 않음
                - 파일에만 부여 가능, 동일한 시스템 내에서만 가능 
                - 파티션이나 디스크 드라이브를 가로질러 사용할 수 없음
        - 심볼릭 링크
            - 하나의 파일을 여러 이름으로 가리키게 하는 형식
            - 바로가기와 단축아이콘과 같은 역할
            - 심볼릭 링크 특징
                - I-node 번호가 원본과 링크 파일의 번호가 다름
                - 생성된 링크 파일 크기가 더 작음
                - ls -l 명령 시 출력되는 권한 영역의 맨 앞쪽에 'l'로 표시
                - 원본이나 링크 파일 중에 어떠한 파일을 수정해도 같이 반영
                - 원본 파일 삭제시 링크는 사용 불가능
                       

<hr>


#### 1.2.2 파일 시스템 관리 및 복구

- 파일 시스템 생성
    - 파일 시스템 생성의 개요
        - 하드 디스크의 용량이 부족한 경우 디스크를 추가 장착하여 용량을 늘림
        - 디스크 장착 후 과정
            - 디스크 인식 여부 확인 >> 파티션 작업 >> 시스템 재부팅 >> 파일 시스템 생성 >> 디렉터리 생성 >> 마운트 작업 >> 마운트 및 용량 확인 >> 부팅 시에 자동 마운트 되도록 /etc/fstab 파일에 등록

    - 파일 시스템 생성의 예
        - 용량이 300GB S-ATA 디스크를 추가 장착하여 100GB를 할당해서 /backup으로 마운트해서 사용 
        1. 디스크 인식 여부 확인 : fdisk -l 명령
        2. 파티션 작업 : 'fdisk 장치명' 명령어 실행 후 원하는 용량만큼 할당
        3. 시스템 재부팅 : 파티션의 정보 업데이트 >> # partpobe, #reboot 명령 실행 또는 재부팅(활성화 여부는 'cat /proc/partitios'로 확인)
        4. 파일 시스템 생성 : # mkfs.xfs /dev/sdb1
        5. 디렉터리 생성 : # mkdir /backup
        6. 마운트 작업: # mount -t xfs /dev/sdb1 /backup
        7. 마운트 및 용량 확인 : # mount, # df -h 
        8. /etc/fstab 파일 등록
            ````
                # vi /etc/fstab
                /dev/sdb1  /backup  xfs  defaults  l  l

- 관련 명령어
    - fdisk
        - 디스크 파티션을 확인하고 추가/삭제하는 명령
        - 사용법
            ````
                #fdisk [option] [장치파일명]

        - 주요 옵션
        
            |옵션|설명|
            |---|---|
            |-l [장치파일명]|지정한 장치 파일의 파티션 테이블 정보 출력, 기본은 /proc/patitions 기반으로 장착된 디스크 출력|
            |-s partition|특정 파티션 크기 출력, block|
            |-v|버전 출력|

        - 사용 예시 
            ````
                # fdisk -l
                # fdisk /dev/sdb : /dev/sdb 파티션 설정

        - fdisk 실행 시 주요 명령
            - fdisk 입력시 텍스트 기반의 특정 명령어를 입력해야 파티션 설정가능('m' 목록 확인 가능)

                |주요 명령|설명|
                |---|---|
                |p|현재 디스크 정보 출력|
                |d|파티션 삭제|
                |n|파티션 새롭게 생성, 추가|
                |t|파티션의 속성 변경|
                |w|변경된 파티션의 정보 저장후 종료|
                |q|변경된 파티션의 정보 저장하지 않고 종료|
    - mkfs
        - 새로운 파일 시스템을 만드는 명령
        - 사용법 
            ````
                #mkfs [-t fs_type] [option] 장치명

        - 주요 옵션

            |옵션|설명|
            |---|---|
            |-t fs_type|파일 시스템의 유령을 지정, 기본 ext2 생성|
            |-c|배드블록을 체크한 후 파일 시스템 구축|
            |-v|결과 상세히 출력|

        - 사용 예시
            ````
                # mkfs -t xfs /dev/sdc1 : /dev/sdc1을 xfs으로 파일 시스템 생성
                # mkfs -t ext4 /dev/sdc1        

    - mke2fs
        - ext2, ext3, ext4 파일 시스템을 만드는 명령
        - 사용법
            ````
                #mke2fs[option] 장치명

        - 주요 옵션

            |옵션|설명|
            |---|---|
            |-j|저널링 파일 시스템인 ext3로 만듦|
            |-t fs_type|파일 시스템의 유형 지정(ext2, ext3, ext4)|
            |-b block_size|블록 사이즈 지정(1024,2048,4096)|
            |-R raid_options|RAID 관련 옵션,-R 다음에 argument=값 형태 지정|
            |-T usage_Type|I-node 크기를 지정 <br> - RHEL 4 : fs_type, news, largefile, largefile4 <br> - news: 4k, largefile : 1M, largefile4 : 4M | <br> - RHEL 5 : /etc/mke2fs.conf|


        - 사용 예시
            ````    
                # mke2fs -j /dev/sdb1
                # mke2fs -j -b 4096 -R stride=32 /dev/md0
                # mke2fs -j -T largefile /dev/hda7

    - mkfs.xfs
        - XFS 파일 시스템을 만드는 명령
        - 사용법
            ````
                #mkfs.xfs [option] 장치명

        - 주요 옵션
            
            |옵션|설명|
            |---|---|
            |-b block_size|블록 사이즈 지정 옵션, 512~ 65536바이트, 기본 4096바이트|
            |-f|지정한 디바이스에 파일 시스템이 존재하는 경우 강제로 수행|

        - 사용 예시
            ```` 
                # mkfs.xfs /dev/sdb1       

    - mount
        - 보조 기억장치나 파일 시스템이 다른 디스크 /의 하위 디렉터리로 연결하여 사용 가능하게 하는 명령

        - 사용법
            ````
                # mount [option][device][diretory]

        - 주요 옵션
            
            |옵션|설명|
            |---|---|
            |-a|/etc/fstab에 명시된 파일 시스템 마운트 옵션|
            |-t fs_type|파일 시스템 유형을 지정, 기본 /etc/fstap 참조|
            |-o 항목|마운트 추가 설정 적용 옵션, 콤마(,)로 다수 조건 구분|

        - 사용 예시
            ````

    - umount
    - eject

- 관련 파일
    - /etc/fstab
        - fstab의 필드 구성
        - fstab 4번째 필드의 주요 옵션
    
    - /etc/mtab
    - blkid

- 파일 시스템 점검 및 관리
    - fsck(filesystem check)
    - e2fsck
    - xfs_repair
    - df(disk free)
    - du(disk usage)
    - dd(Data Dumper)
    - partprobe
    - 
- 스왑(Swap) 생성
    - 스왑의 개요
    - 관련 명령어
        1. mkswap
        2. swapon
        3. swapoff
        4. free

- 스왑 영역 만들기
    - 스왑파일 생성하기
    - 스왑파티션 생성하기

- Disk Quota
    - 디스크 쿼터의 개요
    - 관련 명령어
        - xfs_quote
        - edquote
        - requote
        - quote
        - setquota
    - 사용자 쿼터 설정하기
    - 그룹 쿼터 설정하기


    <hr>


    #### 1.2.3 파일 시스템 관련 명령어

    - 디렉터리 관련 명령어
        - pwd(print working directory)
        - cd(change directory)
        - mkdir(make directory)
        - rmdir(remove directory)
        - tree

    - 파일 관련 명령어
        - ls(list)
        - cp(copy)
        - rm(remove)
        - mv(move)
        - touch
        - file
        - locate
        - find

    - 텍스트 파일 관려 명령어
        - cat(concatenate)
        - head
        - tail
        - more
        - less
        - grep(Grobal Regular Expresstion Print)
        - grep 멸령과 정규표현식
        - wc(word count)
        - sort
        - cut
        - split
        - tr
        - sed
        - awk    
